.\" Process this file with
.\" groff -man -Tascii foo.1
.\"
.\" "verbatim" environment (from strace.1)
.de CW
.sp
.nf
.ft CW
..
.de CE
.ft
.fi
.sp
..
.\"
.TH fakechroot 1 "18 Aug 2003" "Debian Project" "Debian manual"
.\" Manpage by J.H.M. Dassen <jdassen@wi.LeidenUniv.nl>
.SH NAME
fakechroot \- gives a fake chroot environment
.SH SYNOPSIS
.B fakechroot 
.B [\-l|\-\-lib
.IB library] 
.B [\-\-faked
.IB faked-binary ] 
.B [\-i
.IB load-file ]
.B [\-s
.IB save-file ]
.B [\-u|\-\-unknown\-is\-real ]
.BI [\-\-]
.BI [command]
.SH DESCRIPTION
.B fakechroot
runs a command in an environment were it appears to have root privileges for
file manipulation.  This is almost the same as fakeroot(1) command with
additional possibility to use chroot(8) command in such environment.
This is useful for allowing users to create own chrooted environment with
possibility to install another packages without need for root privileges.

.B fakechroot
is heavily based on fakeroot(1) and replaces more library functions (chroot(2),
open(2) etc.) by ones that simulate the effect the real library
functions would have had, had the user really been in chroot. These wrapper
functions are in a shared library
.B /usr/lib/libfakechroot.so*
which is loaded through the 
.B LD_PRELOAD
mechanism of the dynamic loader. (See
.BR ld.so (8))

In fake chroot you can install Debian bootstrap with `debootstrap --fakechroot' command.
In this environment you can use i.e. apt-get(8) command to install another packages from
common user's account.

.SH OPTIONS
.TP
\fB\-l\fR \fIlibrary\fR, \fB\-\-lib\fR \fIlibrary\fR
Specify an alternative wrapper library.
.TP
.BI \-\-faked \ binary
Specify an alternative binary to use as faked.
.TP
.BI [\-\-] \ command
Any command you want to be ran as fakechroot. Use \(oq\-\-\(cq if in the command
you have other options that may confuse fakechroot's option parsing.
.TP
.BI \-s \ save-file
Save the fakechroot environment to save-file on exit. This file can be
used to restore the environment later using \-i. However, this file will
leak and fakechroot will behave in odd ways unless you leave the files
touched inside the fakechroot alone when outside the environment. Still,
this can be useful. For example, it can be used with rsync(1) to back up
and restore whole directory trees complete with user, group and device
information without needing to be root. See
.I /usr/share/doc/fakeroot/README.saving
for more details.
.TP
.BI \-i \ load-file
Load a fakechroot environment previously saved using \-s from load-file.
Note that this does not implicitly save the file, use \-s as well for
that behaviour. Using the same file for both \-i and \-s in a single
.BR fakechroot
invocation is safe.
.TP
\fB\-u\fR, \fB\-\-unknown\-is\-real\fR
Use the real ownership of files previously unknown to fakechroot instead of
pretending they are owned by root:root.

.SH EXAMPLES
Here is an example session with 
.BR fakechroot . 
Notice that inside the fake root environment file manipulation that
requires root privileges succeeds, but is not really happening.
.CW
$ fakeroot \-s fakeroot.save
# export PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/bin/X11
# debootstrap --fakechroot woody /tmp/fakeroot
# exit
$ fakeroot \-s fakeroot.save \-i fakeroot.save
# chroot /tmp/fakeroot /bin/bash
# rm \-f /dev/tty
# adduser \-\-uid 1001 dexter
# nano /etc/apt/sources.lists
# apt\-get update
# apt\-get install build\-essential
# cd /tmp
# apt\-get source hello
# cd hello\-*
# debuild \-E
# exit
.CE

.SH SECURITY ASPECTS
.B fakechroot
is a regular, non-setuid program. It does not enhance a user's
privileges, or decrease the system's security.
.SH FILES
.I /usr/lib/libfakechroot/libfakechroot.so*
The shared library containing the wrapper functions.
.SH ENVIRONMENT
.B 
.IP FAKEROOTKEY
The key used to communicate with the fakeroot daemon. Any program
started with the right 
.B LD_PRELOAD
and a
.B FAKEROOTKEY
of a running daemon will automatically connect to that daemon, and
have the same "fake" view of the file system's permissions/ownerships.
(assuming the daemon and connecting program were started by the same
user). 
.B 
.IP FAKECHROOT
The root directory for fake chroot environment.
.SH LIMITATIONS
.IP "\(bu" 4
Every command executed within 
.B fakechroot 
needs to be linked to the same version of the C library as
.B fakechroot
itself. Because the Potato version of Debian now uses libc6 only
(glibc2.1), this isn't that much of a problem any more. 
.IP "\(bu" 4
Statically linked binaries doesn't work, especially ldconfig(8),
so you have to wrap this command and i.e. set the dpkg diversion.
.IP "\(bu" 4
ldd(1) also doesn't work. You have to use wrapper.
.IP "\(bu" 4
Remove /dev/tty - the full screen apps doesn't work if it exists.
.IP "\(bu" 4
ltrace(1) sometimes doesn't work. strace(1) does work pretty well.
.IP "\(bu" 4
lckpwdf() and ulckpwdf() are ignored so update-passwd(8) should work
.IP "\(bu" 4
Your real uid have to exist in /etc/passwd. Create it with 
`adduser --uid realuid realuser'.
.IP "\(bu" 4
debuild(1) cleans environment. Use -E option to prevent this behaviour.
.IP "\(bu" 4
fakeroot's -s option doesn't work well. You can use simple shell
scripts to save and restore faked modes.

.SH BUGS
It doesn't wrap open(). This isn't bad by itself, but if a program
does open("file", O_WRONLY, 000), writes to file "file", closes it,
and then again tries to open to read the file, then that open fails, as
the mode of the file will be 000. The bug is that if root does the
same, open() will succeed, as the file permissions aren't checked at
all for root. I choose not to wrap open(), as open() is used by many
other functions in libc (also those that are already wrapped), thus
creating loops (or possible future loops, when the implementation of
various libc functions slightly change).
.SH COPYING
.B fakechroot
is distributed under the GNU General Public License.
(GPL 2.0 or greater).
.SH AUTHOR
joost witteveen
.RI < joostje@debian.org >
.SH MANUAL PAGE
mostly by J.H.M. Dassen 
.RI <jdassen@wi.LeidenUniv.nl> 
Rather a lot mods/additions by joost.

Adapted to 
.B fakechroot
by Piotr Roszatycki
.RI <dexter@debian.org>
.SH "SEE ALSO"
.BR fakeroot (1)
.BR faked (1)
.BR dpkg\-buildpackage (1),
.BR debuild (1)
.BR /usr/share/doc/fakeroot/DEBUG
